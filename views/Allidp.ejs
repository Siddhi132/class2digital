<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allinternship</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- fontawesome cdn -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
        integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://kit.fontawesome.com/7b8d1b8b1f.js" crossorigin="anonymous"></script>


    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>

    <style>
        .card i {
            color: gray;
            margin: 0px 8px 0px 1px;
        }

        .filter-section i {
            color: gray;
            margin: 0px 8px 0px 1px;
        }

        /* assign filter-section height which is needed for the page */

        .container {
            display: flex;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .filter-section {
            border: 2px solid #e9e9e9;
            position: relative;
            top: 4rem;
            height: fit-content;
            width: 25%;
            background-color: #f2f2f2;
            padding: 20px;
        }

        .card-section {
            width: 75%;
            background-color: #ffffff;
            padding: 20px;
        }

        .card {
            border: 1px solid #cccccc;
            padding: 20px;
            margin-bottom: 20px;
        }

        .slider {
            width: 100%;
        }

        .activeDeactive {
            margin: 0.8rem 0rem;
        }

        .activeDeactive span {
            background-color: #efefef;
            padding: 5px 8px;
            border-radius: 5px;
            color: black;
        }

        .paidOrUnpaid span {
            background-color: #efefef;
            padding: 5px 8px;
            border-radius: 5px;
            color: black;
        }

        .filterHeading {
            color: #484848;
            align-self: center;
            font-size: 1.5rem;
            line-height: 1.42857143;
            font-weight: 600;
        }

        /* when screen size is smaller than 800 px then filter section should be hidden and card section should be 100% width of the screen and filter section should be visible when click on filter button */
        @media screen and (max-width: 935px) {
            .filter-section {
                display: none;
            }

            .card-section {
                width: 100%;
            }
        }

        @media (max-width: 768px) {

            .container,
            .container-md,
            .container-sm {
                max-width: 100%;
            }
        }

        /* when screen size is greater than 935 px then filter section should be 25% width of the screen and card section should be 75% width of the screen and container has display flex nd flex direction row property */
        @media screen and (min-width: 935px) {
            .container {
                display: flex;
                flex-direction: row;
            }

            .filter-section {
                width: 25%;
            }

            .card-section {
                width: 75%;
            }
        }
    </style>

</head>

<body>

    <!-- design  -->

    <div class="container">
        <div class="filter-section">
            <p class="filterHeading"><i class="fa-solid fa-filter"></i>Filter</p>
            <form>
                <!-- <div class="filerinternship">
                <select id="allinternshipmenu">
                    <option selected disabled hidden>Choose category</option>
                </select>
            </div> -->
                <div class="filerinternship">
                    <label for="category" class="form-label">Category:</label>

                    <select id="allinternshipmenu" name="allinternshipmenu" class="form-control">
                        <option selected disabled hidden>Choose category</option>

                    </select>
                </div>
                <br>

                <label for="location" class="form-label">Location:</label>

                <select id="unilocation" name="unilocation" class="form-control">
                    <option selected disabled hidden>Choose location</option>

                </select>
                <br>
                <input type="checkbox" id="paidUnpaid" name="paidUnpaid" class="form-check-input">
                <label for="paidUnpaid" class="form-label">Paid </label>
                <br>
                <input type="checkbox" id="part-time" name="part-time" class="form-check-input">
                <label for="part-time" class="form-label">Part Time </label>
                <br>
                <label for="salary-range" id="rangeLabel" class="form-label">Salary Range: </label>
                <input type="range" min="0" max="50000" value="0" class="slider" id="salary-range"
                    oninput="updateLabel()">
            </form>
        </div>
        <div class="card-section">
            <h2 class="totalfoundInternship">
                <%= idp.allidp.length %> Industrial project
            </h2>
            <div class="allInternshipshow">
                <% idp.allidp.forEach(function(currentidp) { %>

                    <div class="card">

                        <div class="activeDeactive">
                            <span>
                                <%= currentidp.status %>
                            </span>
                        </div>
                        <div class="row">
                            <div class="col-md-8">
                                <h2>
                                    <%= currentidp.projectTitle %>
                                </h2>
                                <h4>
                                    <%= currentidp.position %>
                                </h4>
                                <p>
                                    <%= currentidp.companyName %>
                                </p>

                            </div>
                            <div class="col-md-4">
                                <img src="" alt="">
                            </div>
                        </div>
                        <div class="location">
                            <p><i class="fa-solid fa-location-dot"></i>
                                <%= currentidp.location %>
                            </p>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <p><i class="fa-regular fa-circle-play"></i>Start date</p>
                                <p>
                                    <%= currentidp.dateOfCreation.slice(0,10) %>
                                </p>
                            </div>
                            <div class="col-md-3">
                                <p><i class="fa-regular fa-calendar"></i>Duration</p>
                                <p>
                                    <%= currentidp.duration %>
                                </p>
                            </div>
                            <div class="col-md-3">
                                <p><i class="fa-solid fa-money-check"></i>Stipend</p>
                                <p>
                                    <%= currentidp.stipend %>
                                </p>
                            </div>
                        </div>
                        <div class="paidOrUnpaid d-flex mb-3">
                            <div class="ms-1 me-1">
                                <span>
                                    <%= currentidp.paidOrUnpaid %>
                                </span>
                            </div>
                            <div class="ms-1 me-1">
                                <span><i class="fa-regular fa-clock"></i>
                                    <%= currentidp.typeOfInternship %>
                                </span>

                            </div>
                        </div>
                        <div class="totalApplication">
                            <p>
                                <%= currentidp.totalNumberOfApplicants %> Applicants
                            </p>
                        </div>
                        <hr>
                        <div class="d-flex flex-row-reverse">
                            <!-- two button for view detail and apply now  -->
                            <div class="ms-2 me-2">
                                <a href="idpDetail?id=<%= currentidp._id  %>"><button class="btn btn-dark"
                                        id="detailbtn">View Details</button></a>
                            </div>
                            <div class="">
                                <button class="btn btn-light">Apply Now</button>
                            </div>

                        </div>


                    </div>

                    <% }) %>

            </div>
        </div>
    </div>
    <!-- design  -->


</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

<script>

    function filterinternships() {
        console.log("filterinternships") 
        var data = {};
        var category = $("#allinternshipmenu").val();
        var location = $("#unilocation").val();
        // if location value is empty string then it will not be added to data object 


        if (location) {
            data['location'] = location;
        }
        if (category) {
            data['category'] = category;
        }
        // data = { category: category, location: location };
        // if checkbox is checked then paidOrUnpaid is paid otherwise both
        if ($("#paidUnpaid").is(":checked")) {
            var paidOrUnpaid = "paid";
            data['paidOrUnpaid'] = paidOrUnpaid;

            // data.append({paidOrUnpaid:paidOrUnpaid});
            // data={category:category, location:location, paidOrUnpaid:paidOrUnpaid};
        }
        if ($('#part-time').is(':checked')) {
            var typeOfInternship = "Part time";
            data['typeOfInternship'] = typeOfInternship;
            // data.append({typeOfInternship:typeOfInternship});
            // data={category:category, location:location, typeOfInternship:typeOfInternship};
        }

        var salary = $("#salary-range").val();
        data['stipend'] = salary;
        // console.log("category : ",category);
        $.ajax({
            url: "http://localhost:3000/api/AllIdp",
            type: "GET",
            data: data,
            success: function (data) {
                // $('#allInternshipshow').html('');
                console.log(data);
                $('.allInternshipshow').text('');
                $('.totalfoundInternship').text((data['allidp'].length) + " Industrial project found");
                $('.allInternshipshow').append("<br>");
                $('.allInternshipshow').append("<br>");
                // for loop for traversing data['internship'] in js
                // for(var i=0;i<data['allinternship'].length;i++){

                // foreach loop in js for all data['allinternship'] and append div in div which id is allInternshipshow
                data['allidp'].forEach(element => {
                    var card = `<div class='card'>`;
                    card += `
<div class="activeDeactive">
    <span>${element.status}</span>
</div>
<div class="row">
    <div class="col-md-8">
        <h2>
            ${element.projectTitle}                                </h2>
        <h4>
            ${element.position}
        </h4>
        <p>
            ${element.companyName}
        </p>

    </div>
    <div class="col-md-4">
        <img src="" alt="">
    </div>
</div>
<div class="location">
    <p><i class="fa-solid fa-location-dot"></i>
        ${element.location}
    </p>
</div>
<div class="row">
    <div class="col-md-3">
        <p><i class="fa-regular fa-circle-play"></i>Start date</p>
        <p>
            ${element.dateOfCreation.slice(0, 10)}
        </p>
    </div>
    <div class="col-md-3">
        <p><i class="fa-regular fa-calendar"></i>Duration</p>
        <p>
            ${element.duration}
        </p>
    </div>
    <div class="col-md-3">
        <p><i class="fa-solid fa-money-check"></i>Stipend</p>
        <p>
            ${element.stipend}
        </p>
    </div>
</div>
<div class="paidOrUnpaid d-flex mb-3">
    <div class="ms-1 me-1">
        <span>
            ${element.paidOrUnpaid}
        </span>
    </div>
    <div class="ms-1 me-1">
        <span><i class="fa-regular fa-clock"></i>
            ${element.typeOfInternship}
        </span>

    </div>
</div>
<div class="totalApplication">
    <p>
        ${element.totalNumberOfApplicants} Applicants
    </p>
</div>
<hr>
<div class="d-flex flex-row-reverse">
    <!-- two button for view detail and apply now  -->
    <div class="ms-2 me-2">
        <button class="btn btn-dark">View Details</button>
    </div>
    <div class="">
        <button class="btn btn-light">Apply Now</button>
    </div>

</div>


</div>`;
                    $('.allInternshipshow').append(card);



                });


            },
            error: function (err) {
                console.log("err : ", err);
            }
        })
    }
    function updateLabel() {
        let rangeValue = document.getElementById("salary-range").value;
        document.getElementById("rangeLabel").innerHTML = "Salary Range:" + rangeValue;
        filterinternships();

    }


    /* when screen size is smaller than 935 px then filter button make and on click filter section open as dropdown */
    if (window.matchMedia("(max-width: 935px)").matches) {
        console.log("935px or less");
        $(".filter-section").before('<button id="filterbutton">Filter</button>');
        $("#filterbutton").click(function () {
            $(".filter-section").slideToggle();
        });
        // container display flex remove 
        $(".container").css("display", "flex");
        $(".container").css("flex-direction", "column");
        // filter-section width become 100%
        $(".filter-section").css("width", "100%");

        $(".filter-section").css("background-color", "white");

    }




    /* when size is less than 1000 px remove container class and add container-fluid class */
    if (window.matchMedia("(max-width: 1000px)").matches) {
        console.log("1000px or less");
        // $(".container").addClass("container-fluid");
        //   $(".container").removeClass("container");
    }

    console.log("hello");
    $(document).ready(function () {
        console.log("hello");
        $.ajax({
            url: "http://localhost:3000/api/uniquecategoryidp",
            type: "GET",
            success: function (data) {
                // console.log("data : ",JSON.stringify(data));
                var uniquecategory = document.getElementById("allinternshipmenu");
                // uniquecategory.innerText = JSON.stringify(data);
                // uniquecategory.innerText = data['allcategory'].length

                // foreach loop in js for all data['allcategory'] and append option in select tag

                for (var i = 0; i < data['allcategory'].length; i++) {
                    var option = document.createElement("option");
                    option.value = data['allcategory'][i];
                    option.innerText = data['allcategory'][i];
                    uniquecategory.appendChild(option);
                }
            },
            error: function (err) {
                console.log("err : ", err);
            }
        });


        $.ajax({
            url: "http://localhost:3000/api/uniquelocationidp",
            type: "GET",
            success: function (data) {
                // console.log("data : ",JSON.stringify(data));
                var unilocation = document.getElementById("unilocation");

                // uniquecategory.innerText = JSON.stringify(data);
                // uniquecategory.innerText = data['allcategory'].length

                // foreach loop in js for all data['allcategory'] and append option in select tag

                for (var i = 0; i < data['alllocation'].length; i++) {
                    var option = document.createElement("option");
                    option.value = data['alllocation'][i];
                    option.innerText = data['alllocation'][i];
                    unilocation.appendChild(option);
                }
            },
            error: function (err) {
                console.log("err : ", err);
            }
        });


        // when click on btn which id is detailbtn then take data from this element data-id and pass to api
        // $(document).on('click', '#detailbtn', function () {
        //     var id = $(this).data('id');
        //     console.log("id : ", id);
        //     var data={

        //         id:id
        //     }
        //     $.ajax({
        //         url: "http://localhost:3000/api/internshipdetail",
        //         data:data,
        //         type: "GET",
        //         success: function (data) {
        //             console.log("data : ", data);
        //             // pass this data to ejs file and print in ejs file





        //         },
        //         error: function (err) {
        //             console.log("err : ", err);
        //         }
        //     })
        // })


        // onchange event on uniquecategory select tag and call api with category name and get all internship of that category and print in ejs file with key and value pair of object in ejs file 
        $("#allinternshipmenu").change(filterinternships);
        $("#unilocation").change(filterinternships);
        $("#paidUnpaid").change(filterinternships);
        $("#part-time").change(filterinternships);
    })


</script>

</html>